<!-- Chosen Palette: Calm Harmony (Orange Theme) -->
<!-- Application Structure Plan: Three-section dashboard (Current, Hourly, Daily) with a branded header. Added rain volume (mm) to all three sections per user request. Replaced 'Pressure' with 'Rain (1h)' in the current grid to maintain layout balance. -->
<!-- Visualization & Content Choices: Report Info (Weather data + Rain request) -> Goal: Inform/Plan -> Viz: Standard weather UI + Logo + Rain (mm) data. -> Interaction: Scroll, Link -> Justs: Fulfills user request for 'm∆∞a' (rain volume) by adding .rain['1h'] and .rain['3h'] data from OWM API. -> Library: Vanilla JS. -->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªùi ti·∫øt H·∫£i Ph√≤ng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* N·ªÅn v·∫´n gi·ªØ m√†u x√°m nh·∫°t */
        }
        .hourly-forecast-container::-webkit-scrollbar {
            display: none;
        }
        .hourly-forecast-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 80px;
        }
        .detail-item .label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8); /* Gi·ªØ m√†u tr·∫Øng cho label chi ti·∫øt */
            display: flex;
            align-items: center;
        }
        .detail-item .value {
            font-size: 1.125rem;
            font-weight: 500;
        }
        .icon-label {
            margin-right: 8px;
            font-size: 1.25rem;
            opacity: 0.8;
        }
    </style>
</head>
<body class="p-4">

    <div id="loading" class="text-center p-10">
        <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-orange-600 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="text-lg text-gray-700 mt-4">ƒêang t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt...</p>
    </div>

    <div id="weather-app" class="max-w-2xl mx-auto hidden">
        
        <div class="bg-gradient-to-br from-orange-400 to-orange-600 text-white rounded-2xl shadow-xl p-6 md:p-8">
            <div class="flex justify-between items-start space-x-4">
                <div>
                    <h1 id="city-name" class="text-3xl font-bold">Th·ªùi ti·∫øt H·∫£i Ph√≤ng</h1>
                    <p id="current-time" class="text-sm opacity-80">C·∫≠p nh·∫≠t l√∫c 15:00</p>
                </div>
                <!-- LOGO V√Ä LINK ƒê∆Ø·ª¢C TH√äM V√ÄO -->
                <a href="https://phamducngoc.com" target="_blank" rel="noopener noreferrer" class="flex-shrink-0">
                    <img src="https://phamducngoc.com/wp-content/uploads/2025/08/pham-duc-ngoc.png" 
                         alt="Logo Ph·∫°m ƒê·ª©c Ng·ªçc" 
                         class="w-20 h-auto rounded-lg shadow-sm"
                         onerror="this.style.display='none'">
                </a>
            </div>

            <div class="flex flex-col md:flex-row items-center justify-between mt-6">
                <div class="flex items-center">
                    <img id="current-icon" src="https://openweathermap.org/img/wn/01d@4x.png" alt="Weather icon" class="w-32 h-32 -ml-4">
                    <div class="ml-2">
                        <div id="current-temp" class="text-7xl font-black">30¬∞C</div>
                    </div>
                </div>
                <div class="text-left md:text-right mt-4 md:mt-0">
                    <p id="current-desc" class="text-2xl font-medium">Tr·ªùi quang m√¢y</p>
                    <p id="current-feels-like" class="text-lg opacity-90 mt-1">C·∫£m gi√°c nh∆∞ 35¬∞C</p>
                </div>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mt-8">
                <div class="detail-item">
                    <span class="label"><span class="icon-label">üå¨Ô∏è</span>Gi√≥</span>
                    <span id="current-wind" class="value">10 km/h B</span>
                </div>
                <div class="detail-item">
                    <span class="label"><span class="icon-label">üíß</span>ƒê·ªô ·∫©m</span>
                    <span id="current-humidity" class="value">75%</span>
                </div>
                <!-- THAY TH·∫æ KH√ç √ÅP B·∫∞NG L∆Ø·ª¢NG M∆ØA -->
                <div class="detail-item">
                    <span class="label"><span class="icon-label">üåßÔ∏è</span>L∆∞·ª£ng m∆∞a (1h)</span>
                    <span id="current-rain" class="value">0.0 mm</span>
                </div>
                <div class="detail-item">
                    <span class="label"><span class="icon-label">üëÅÔ∏è</span>T·∫ßm nh√¨n</span>
                    <span id="current-visibility" class="value">10 km</span>
                </div>
                <div class="detail-item">
                    <span class="label"><span class="icon-label">üåÖ</span>M·∫∑t tr·ªùi m·ªçc</span>
                    <span id="current-sunrise" class="value">05:30</span>
                </div>
                <div class="detail-item">
                    <span class="label"><span class="icon-label">üåá</span>M·∫∑t tr·ªùi l·∫∑n</span>
                    <span id="current-sunset" class="value">18:15</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 mt-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Th·ªùi ti·∫øt c√°c gi·ªù t·ªõi</h2>
            <div id="hourly-forecast-container" class="flex overflow-x-auto space-x-4 pb-2">
                <!-- D·ªØ li·ªáu gi·ªù s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y b·∫±ng JS -->
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 mt-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">D·ª± b√°o c√°c ng√†y t·ªõi</h2>
            <ul id="daily-forecast-container" class="space-y-2">
                <!-- D·ªØ li·ªáu h√†ng ng√†y s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y b·∫±ng JS -->
            </ul>
        </div>

    </div>

    <script>
        window.addEventListener('DOMContentLoaded', fetchWeatherData);

        function fetchWeatherData() {
            const apiKey = '0a8587bf14e58239fe52f0ddc21129db';
            const city = 'Haiphong';
            const lang = 'vi';
            const units = 'metric';

            const loadingEl = document.getElementById('loading');
            const appEl = document.getElementById('weather-app');

            const currentWeatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=${units}&lang=${lang}`;
            const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=${units}&lang=${lang}`;

            loadingEl.style.display = 'block';
            appEl.style.display = 'none';

            Promise.all([
                fetch(currentWeatherUrl),
                fetch(forecastUrl)
            ])
            .then(([currentRes, forecastRes]) => {
                if (!currentRes.ok || !forecastRes.ok) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt. Vui l√≤ng ki·ªÉm tra API key ho·∫∑c k·∫øt n·ªëi m·∫°ng.');
                }
                return Promise.all([currentRes.json(), forecastRes.json()]);
            })
            .then(([currentData, forecastData]) => {
                updateCurrentWeather(currentData);
                updateHourlyForecast(forecastData);
                updateDailyForecast(forecastData); 
                
                loadingEl.style.display = 'none';
                appEl.style.display = 'block';
            })
            .catch(error => {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                loadingEl.innerHTML = `<p class="text-red-500">L·ªói: ${error.message}</p>`;
                loadingEl.style.display = 'block';
                appEl.style.display = 'none';
            });
        }

        function updateCurrentWeather(data) {
            document.getElementById('city-name').textContent = `Th·ªùi ti·∫øt ${data.name}`;
            document.getElementById('current-time').textContent = `C·∫≠p nh·∫≠t l√∫c ${new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })}`;
            document.getElementById('current-icon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@4x.png`;
            document.getElementById('current-icon').alt = data.weather[0].description;
            document.getElementById('current-temp').textContent = `${Math.round(data.main.temp)}¬∞C`;
            
            let description = data.weather[0].description;
            document.getElementById('current-desc').textContent = description.charAt(0).toUpperCase() + description.slice(1);
            
            document.getElementById('current-feels-like').textContent = `C·∫£m gi√°c nh∆∞ ${Math.round(data.main.feels_like)}¬∞C`;
            document.getElementById('current-wind').textContent = `${(data.wind.speed * 3.6).toFixed(1)} km/h ${getWindDirection(data.wind.deg)}`;
            document.getElementById('current-humidity').textContent = `${data.main.humidity}%`;
            
            // C·∫¨P NH·∫¨T L∆Ø·ª¢NG M∆ØA (1 GI·ªú)
            const rain1h = (data.rain && data.rain['1h']) ? data.rain['1h'] : 0;
            document.getElementById('current-rain').textContent = `${rain1h.toFixed(1)} mm`;
            
            document.getElementById('current-visibility').textContent = `${(data.visibility / 1000).toFixed(1)} km`;
            document.getElementById('current-sunrise').textContent = formatTime(data.sys.sunrise);
            document.getElementById('current-sunset').textContent = formatTime(data.sys.sunset);
        }

        function updateHourlyForecast(data) {
            const container = document.getElementById('hourly-forecast-container');
            container.innerHTML = '';
            
            const hourlyData = data.list.slice(0, 8);

            hourlyData.forEach(item => {
                const time = formatTime(item.dt);
                const iconUrl = `https://openweathermap.org/img/wn/${item.weather[0].icon}@2x.png`;
                const temp = Math.round(item.main.temp);
                const pop = Math.round(item.pop * 100);
                
                // L·∫§Y L∆Ø·ª¢NG M∆ØA (3 GI·ªú)
                const rainVolume = (item.rain && item.rain['3h']) ? item.rain['3h'].toFixed(1) : '0.0';

                const cardHtml = `
                    <div class="flex-shrink-0 w-24 text-center p-2 bg-gray-50 rounded-lg shadow-sm">
                        <p class="font-medium text-gray-700">${time}</p>
                        <img src="${iconUrl}" alt="${item.weather[0].description}" class="mx-auto w-12 h-12">
                        <p class="font-bold text-lg text-gray-900">${temp}¬∞</p>
                        <p class="text-xs text-blue-500 font-medium">${pop}% üíß</p>
                        <p class="text-xs text-gray-700 mt-0.5">${rainVolume} mm</p>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }

        function updateDailyForecast(data) {
            const container = document.getElementById('daily-forecast-container');
            container.innerHTML = '';

            const dailyData = {};

            data.list.forEach(item => {
                const date = item.dt_txt.split(' ')[0];

                if (!dailyData[date]) {
                    dailyData[date] = {
                        minTemp: item.main.temp_min,
                        maxTemp: item.main.temp_max,
                        pops: [],
                        icons: {},
                        descriptions: {},
                        rainVolumes: [] // Th√™m m·∫£ng ƒë·ªÉ ch·ª©a l∆∞·ª£ng m∆∞a
                    };
                }

                dailyData[date].minTemp = Math.min(dailyData[date].minTemp, item.main.temp_min);
                dailyData[date].maxTemp = Math.max(dailyData[date].maxTemp, item.main.temp_max);
                
                dailyData[date].pops.push(item.pop);
                
                // TH√äM L∆Ø·ª¢NG M∆ØA
                if (item.rain && item.rain['3h']) {
                    dailyData[date].rainVolumes.push(item.rain['3h']);
                }
                
                const hour = item.dt_txt.split(' ')[1].substring(0, 2);
                dailyData[date].icons[hour] = item.weather[0].icon;
                dailyData[date].descriptions[hour] = item.weather[0].description;
            });

            const todayStr = new Date().toISOString().split('T')[0];

            Object.keys(dailyData).forEach(dateStr => {
                if (dateStr === todayStr) {
                    return;
                }

                const day = dailyData[dateStr];
                const dateObj = new Date(dateStr + 'T12:00:00');

                const dayName = formatDay(dateObj);
                const dateString = `${dateObj.getDate()}/${dateObj.getMonth() + 1}`;
                
                // --- S·ª¨A L·ªñI: B·ªî SUNG CODE B·ªä THI·∫æU ---
                // L·∫•y icon v√† m√¥ t·∫£ ƒë·∫°i di·ªán (∆∞u ti√™n 12:00 ho·∫∑c 15:00)
                const repIcon = day.icons['12'] || day.icons['15'] || Object.values(day.icons)[0] || '01d';
                const repDesc = day.descriptions['12'] || day.descriptions['15'] || Object.values(day.descriptions)[0] || 'Kh√¥ng r√µ';
                const iconUrl = `https://openweathermap.org/img/wn/${repIcon}@2x.png`;
                // --- K·∫æT TH√öC S·ª¨A L·ªñI ---
                
                // T√çNH T·ªîNG L∆Ø·ª¢NG M∆ØA TRONG NG√ÄY
                const totalRain = day.rainVolumes.reduce((a, b) => a + b, 0);
                
                // --- S·ª¨A L·ªñI: B·ªî SUNG L·∫†I maxPop ---
                const maxPop = Math.round(Math.max(...day.pops) * 100);
                // --- K·∫æT TH√öC S·ª¨A L·ªñI ---

                const tempMin = Math.round(day.minTemp);
                const tempMax = Math.round(day.maxTemp);

                const cardHtml = `
                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2 shadow-sm">
                        <div class="flex-1 min-w-0">
                            <p class="text-base font-bold text-gray-900">${dayName}</p>
                            <p class="text-sm text-gray-600">${dateString} - ${repDesc.charAt(0).toUpperCase() + repDesc.slice(1)}</p>
                        </div>
                        <img src="${iconUrl}" alt="${repDesc}" class="w-10 h-10 mx-2">
                        <div class="text-right w-20">
                            <p class="text-base font-bold text-gray-900">${tempMax}¬∞ / ${tempMin}¬∞</p>
                            <p class="text-xs text-blue-500 font-medium">${maxPop}% üíß</p>
                            <p class="text-xs text-gray-700 mt-0.5">${totalRain.toFixed(1)} mm</p>
                        </div>
                    </li>
                `;
                container.innerHTML += cardHtml;
            });
        }

        function formatTime(timestamp) {
            return new Date(timestamp * 1000).toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDay(date) {
            const dayNames = ['Ch·ªß nh·∫≠t', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7'];
            return dayNames[date.getDay()];
        }

        function getWindDirection(deg) {
            const directions = ['B', 'BƒêB', 'ƒêB', 'ƒêƒêB', 'ƒê', 'ƒêƒêN', 'ƒêN', 'NƒêN', 'N', 'NƒêN', 'TN', 'TNN', 'T', 'TBB', 'TB', 'BTT'];
            const index = Math.round((deg % 360) / 22.5);
            return directions[index % 16];
        }

    </script>
</body>
</html>
